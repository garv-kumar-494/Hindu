<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Community - Temple Member</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#D97706",
                        "primary-dark": "#B45309",
                        "background-light": "#FFFCF5",
                        "background-dark": "#1C1917",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#292524",
                        "border-light": "#FED7AA",
                        "border-dark": "#78350F",
                        "text-main": "#431407",
                        "text-light": "#FFFBEB",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"],
                        "serif": ["Playfair Display", "serif"],
                        "body": ["Noto Sans", "sans-serif"],
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "2xl": "1rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #FED7AA;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #78350F;
        }

        .theme-pattern {
            background-color: transparent;
            background-image: radial-gradient(#F59E0B 0.5px, transparent 0.5px), radial-gradient(#F59E0B 0.5px, transparent 0.5px);
            background-size: 24px 24px;
            background-position: 0 0, 12px 12px;
            opacity: 0.15;
        }

        .dark .theme-pattern {
            background-image: radial-gradient(#92400E 0.5px, transparent 0.5px), radial-gradient(#92400E 0.5px, transparent 0.5px);
            opacity: 0.25;
        }

        .channel-btn.active {
            background: linear-gradient(to right, #ea580c, #d97706);
            color: white;
            font-weight: 600;
        }

        .message-bubble {
            animation: slideIn 0.3s ease-out;
        }

        .member-card {
            background: linear-gradient(to right, #fff7ed, #ffedd5);
            border: 1px solid #fed7aa;
            transition: all 0.3s ease;
        }

        .member-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(249, 115, 22, 0.2);
        }

        .dark .member-card {
            background: linear-gradient(to right, #292524, #1c1917);
            border-color: #78350f;
        }

        .members-scroll {
            height: 600px;
            overflow-y: auto;
            padding-right: 6px;
        }

        .members-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .members-scroll::-webkit-scrollbar-thumb {
            background: #fdba74;
            border-radius: 10px;
        }

        .dark .members-scroll::-webkit-scrollbar-thumb {
            background: #78350f;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(0);
            }
        }

        /* Mobile sidebar overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 45;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Mobile sidebar drawer */
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 80%;
            max-width: 320px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 50;
        }

        .mobile-sidebar.active {
            transform: translateX(0);
        }

        /* Hide sidebar on mobile by default, show on desktop */
        @media (max-width: 639px) {
            .desktop-sidebar {
                display: none;
            }
        }

        @media (min-width: 640px) {
            .mobile-sidebar {
                display: none;
            }
            .sidebar-overlay {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark antialiased font-display h-screen overflow-hidden flex flex-col">
    <div class="fixed inset-0 theme-pattern pointer-events-none z-0"></div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Mobile Sidebar Drawer -->
    <aside id="mobileSidebar" class="mobile-sidebar bg-surface-light dark:bg-surface-dark flex flex-col">
        <!-- Mobile Sidebar Header -->
        <div class="p-4 border-b border-border-light/40 dark:border-border-dark/40 flex items-center justify-between">
            <h2 class="text-primary-dark dark:text-[#fde68a] text-xs font-bold tracking-widest uppercase">
                Members
            </h2>
            <button onclick="toggleSidebar()"
                class="flex items-center justify-center w-8 h-8 rounded-md hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined text-primary-dark dark:text-[#fde68a] text-lg">close</span>
            </button>
        </div>

        <!-- Mobile Members List -->
        <div class="p-4 flex-1 overflow-hidden">
            <div id="mobileMembersList" class="members-scroll space-y-3">
                <!-- Members injected here -->
            </div>
        </div>
    </aside>

    <!-- HEADER -->
    <header
        class="flex items-center justify-between px-4 py-3 sticky top-0 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-sm z-40 transition-colors border-b border-border-light/40 dark:border-border-dark/40">
        <div class="flex items-center gap-3">
            <!-- Hamburger Menu Button (Mobile Only) -->
            <button onclick="toggleSidebar()"
                class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors sm:hidden">
                <span class="material-symbols-outlined text-primary dark:text-[#f59e0b] text-2xl">menu</span>
            </button>

            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-br from-primary/20 to-primary-dark/20">
                <span class="material-symbols-outlined text-primary dark:text-[#f59e0b] text-2xl">temple_hindu</span>
            </div>
            <div>
                <h1 class="text-text-main dark:text-text-light text-xl font-serif font-bold">Community</h1>
                <p class="text-xs text-[#78350f] dark:text-[#fde68a]/60">Temple Member Portal</p>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <button
                class="flex size-10 items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined text-text-main dark:text-text-light">search</span>
            </button>
            <button id="themeToggle"
                class="flex size-10 items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined text-text-main dark:text-text-light" id="themeIcon">dark_mode</span>
            </button>
        </div>
    </header>

    <!-- MAIN -->
    <main class="flex flex-1 overflow-hidden z-10 relative">

        <!-- LEFT: CHANNELS (Desktop Only) -->
        <aside class="desktop-sidebar w-20 sm:w-72 border-r border-border-light/40 dark:border-border-dark/40
                      bg-surface-light/50 dark:bg-surface-dark/50 backdrop-blur-sm
                      flex flex-col h-full overflow-hidden">

            <div class="p-4 border-b border-border-light/40 dark:border-border-dark/40 flex items-center justify-between">
                <h2 class="text-primary-dark dark:text-[#fde68a] text-xs font-bold tracking-widest uppercase">
                    Channels
                </h2>
            </div>

            <div class="p-4 border-t border-border-light/40 dark:border-border-dark/40 flex-1 overflow-hidden">
                <h3 class="text-xs font-bold tracking-widest uppercase text-primary-dark dark:text-[#fde68a] mb-3">
                    Members
                </h3>

                <div id="membersList" class="members-scroll space-y-3">
                    <!-- Members injected here -->
                </div>
            </div>

        </aside>

        <!-- CENTER: CHAT -->
        <section class="flex-1 flex flex-col bg-background-light dark:bg-background-dark overflow-hidden">

            <!-- Channel Header -->
            <div
                class="px-6 py-4 border-b border-border-light/40 dark:border-border-dark/40 bg-surface-light/50 dark:bg-surface-dark/50 backdrop-blur-sm">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary dark:text-[#f59e0b]">tag</span>
                    <h3 id="channelTitle" class="text-text-main dark:text-text-light text-lg font-bold font-serif">General</h3>
                </div>
                <p class="text-xs text-[#78350f] dark:text-[#fde68a]/60 mt-1">Welcome to our community discussion</p>
            </div>

            <!-- Messages -->
            <div id="chatBox" class="flex-1 overflow-y-auto p-6 space-y-4">
               
            </div>

            <!-- Input -->
            <div class="border-t border-border-light/40 dark:border-border-dark/40 p-4 bg-surface-light/50 dark:bg-surface-dark/50 backdrop-blur-sm">
                <div class="flex gap-3 items-end">
                    <div class="flex-1 relative">
                        <input id="messageInput" type="text" placeholder="Type your message here..."
                            class="form-input flex w-full rounded-2xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark h-12 px-4 pr-12 text-base text-text-main dark:text-text-light placeholder-[#9a3412]/40 dark:placeholder-[#fde68a]/30 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all shadow-sm"
                            onkeypress="if(event.key==='Enter') sendMessage()" />
                        <button
                            class="absolute right-2 top-1/2 -translate-y-1/2 size-8 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                            <span class="material-symbols-outlined text-[#78350f] dark:text-[#fde68a]/60">sentiment_satisfied</span>
                        </button>
                    </div>
                    <button onclick="sendMessage()"
                        class="h-12 px-6 bg-gradient-to-r from-[#ea580c] to-[#d97706] hover:from-[#c2410c] hover:to-[#b45309] active:scale-[0.98] transition-all rounded-2xl text-white text-sm font-bold font-display shadow-lg shadow-orange-500/30 flex items-center justify-center gap-2">
                        <span class="hidden sm:inline">Send</span>
                        <span class="material-symbols-outlined">send</span>
                    </button>
                </div>
            </div>

        </section>

    </main>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const html = document.documentElement;

        function updateTheme() {
            if (html.classList.contains('dark')) {
                themeIcon.textContent = 'light_mode';
            } else {
                themeIcon.textContent = 'dark_mode';
            }
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            updateTheme();
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            html.classList.add('dark');
        }
        updateTheme();

        // Toggle Mobile Sidebar
        function toggleSidebar() {
            const mobileSidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            mobileSidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // Prevent body scroll when sidebar is open
            if (mobileSidebar.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        // Close sidebar when window is resized to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 640) {
                const mobileSidebar = document.getElementById('mobileSidebar');
                const overlay = document.getElementById('sidebarOverlay');
                mobileSidebar.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Load Members Function
        async function loadMembers() {
            try {
                const res = await fetch("https://hindu-cc0q.onrender.com/load-members/loadmembers");
                const members = await res.json();

                const desktopList = document.getElementById("membersList");
                const mobileList = document.getElementById("mobileMembersList");
                
                desktopList.innerHTML = "";
                mobileList.innerHTML = "";

                members.forEach(member => {
                    // Create member card for desktop
                    const desktopDiv = createMemberCard(member);
                    desktopList.appendChild(desktopDiv);

                    // Create member card for mobile
                    const mobileDiv = createMemberCard(member, true);
                    mobileList.appendChild(mobileDiv);
                });
            } catch (err) {
                console.error("Failed to load members", err);
            }
        }

        // Create Member Card
        function createMemberCard(member, isMobile = false) {
            const div = document.createElement("div");
            div.className = "member-card rounded-xl p-3 flex items-center gap-3";

            div.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#ea580c] to-[#d97706] 
                            flex items-center justify-center text-white font-bold">
                    ${member.name.charAt(0).toUpperCase()}
                </div>

                <div class="flex-1">
                    <p class="text-sm font-bold text-text-main dark:text-text-light">
                        ${member.name}
                    </p>
                    <p class="text-xs text-[#78350f] dark:text-[#fde68a]/70">
                        ðŸ“ž ${member.phone}
                    </p>
                </div>
            `;

            // Close sidebar when member is clicked on mobile
            if (isMobile) {
                div.addEventListener('click', () => {
                    toggleSidebar();
                });
            }

            return div;
        }
 // Initialize
        loadMembers();









        // Send Message Function
async function sendMessage() {
  const input = document.getElementById('messageInput');
  const message = input.value.trim();
  if (!message) return;

  const chatBox = document.getElementById('chatBox');

// âœ… USER NAME from localStorage
  const userName = localStorage.getItem("userName") || "User";

  const messageDiv = document.createElement('div');
  messageDiv.className = 'message-bubble flex justify-end';

  const now = new Date();
  const time = now.toLocaleString('en-IN', {
    day: '2-digit',
    month: 'short',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    hour12: true
  });

  messageDiv.innerHTML = `
    <div class="text-right max-w-md">
         <!-- ðŸ‘¤ USER NAME -->
         <p class="text-xs font-semibold text-orange-700 mb-0.5">
        ${userName}
      </p>
      <p class="text-xs text-[#78350f] dark:text-[#fde68a]/60 mb-1">
        ${time}
      </p>
      <div class="bg-gradient-to-r from-[#ea580c] to-[#d97706]
                  rounded-2xl rounded-tr-sm px-4 py-3 w-fit ml-auto">
        <p class="text-sm text-white">${message}</p>
      </div>
    </div>
  `;

  chatBox.appendChild(messageDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
  input.value = '';
    // Send message to backend
  await fetch("https://hindu-cc0q.onrender.com/usermessage/user-message", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ 
       sender: "user",
      userName: userName,
      message: message,
      time: time 
    })
  });
}



async function loadAdminMessages() {
  try {
    const res = await fetch("https://hindu-cc0q.onrender.com/adminmessage/admin-messages");
    const messages = await res.json();

    const chatBox = document.getElementById("chatBox");
    chatBox.innerHTML = "";

    messages.forEach(msg => {
      const messageDiv = document.createElement("div");
      messageDiv.className = "message-bubble flex items-start gap-3";

      messageDiv.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#7c2d12] to-[#92400e]
                    flex items-center justify-center text-white font-bold text-sm shrink-0">
          A
        </div>

        <div class="flex-1">
          <div class="flex items-center gap-2 mb-1">
            <span class="text-sm font-bold text-text-main dark:text-text-light">
              Admin
            </span>
            <span class="text-xs text-[#78350f] dark:text-[#fde68a]/60">
              ${msg.time}
            </span>
          </div>

          <div class="bg-gradient-to-r from-[#ea580c] to-[#d97706]
                      rounded-2xl rounded-tl-sm px-4 py-3 w-fit">
            <p class="text-sm text-white">${msg.message}</p>
          </div>
        </div>
      `;

      chatBox.appendChild(messageDiv);
    });

    chatBox.scrollTop = chatBox.scrollHeight;
  } catch (err) {
    console.error("Failed to load admin messages", err);
  }
}
loadAdminMessages();

</script>

<script>
async function loadUserMessages() {
  try {
    const res = await fetch("https://hindu-cc0q.onrender.com/loadusermessages/load-user-messages");
    const messages = await res.json();

    const chatBox = document.getElementById("chatBox");

    messages.forEach(msg => {
      const messageDiv = document.createElement("div");
      messageDiv.className = "message-bubble flex justify-end";

      messageDiv.innerHTML = `
        <div class="text-right max-w-md">
            <p class="text-xs font-semibold text-orange-700 mb-0.5">
                ${msg.userName}  <!-- ðŸ‘¤ USER NAME -->
            </p>
          <p class="text-xs text-[#78350f] dark:text-[#fde68a]/60 mb-1">
            ${msg.time}
          </p>
          <div class="bg-gradient-to-r from-[#ea580c] to-[#d97706]
                      rounded-2xl rounded-tr-sm px-4 py-3 w-fit ml-auto">
            <p class="text-sm text-white">${msg.message}</p>
          </div>
        </div>
      `;

      chatBox.appendChild(messageDiv);
    });

    chatBox.scrollTop = chatBox.scrollHeight;
  } catch (err) {
    console.error("Failed to load user messages", err);
  }
}
loadUserMessages();
</script>


</body>

</html>